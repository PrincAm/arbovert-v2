# htaccess rules for subdomains and aliases
# to create new subdomain, create a folder www/subdom/(subdomain name)
# to create web for alias, create a folder www/domains/(whole domain name)

# htaccess pravidla pro subdomeny a samostatne weby aliasu
# pro vytvoreni subdomeny vytvorte adresar www/subdom/(nazev subdomeny)
# pro vytvoreni webu pro alias vytvorte adresar www/domains/(cely domenovy nazev)
# dalsi info a priklady: http://kb.wedos.com/r/32/webhosting-htaccess.html

RewriteEngine On

# 1) www.arbovert.cz → arbovert.cz (na jakékoli schéma)
RewriteCond %{HTTP_HOST} ^www\.arbovert\.cz$ [NC]
RewriteRule ^ https://arbovert.cz%{REQUEST_URI} [L,R=301]

# 2) http://arbovert.cz → https://arbovert.cz
RewriteCond %{HTTPS} !=on
RewriteCond %{HTTP_HOST} ^arbovert\.cz$      [NC]
RewriteRule ^ https://arbovert.cz%{REQUEST_URI} [L,R=301]

# This handles redirects for static export/server-level (Apache)
# For Next.js server mode, see middleware.js (lines 22-31) which handles the same redirects
# Canonical URLs (use-canonical-url.js) should use paths as-is since redirects ensure they're clean
# Redirect .html URLs to clean URLs (301 permanent redirect)
# This must come before other rules to catch .html requests first
RewriteCond %{REQUEST_URI} \.html$
RewriteCond %{REQUEST_URI} !^/index\.html$
RewriteRule ^(.+)\.html$ $1 [R=301,L]

# Redirect trailing slash URLs to clean URLs (consistent with trailingSlash: false)
RewriteCond %{REQUEST_URI} ^(.+)/$
RewriteCond %{REQUEST_URI} !^/$
RewriteRule ^(.+)/$ $1 [R=301,L]

# Redirect old inventarizace-drevin URL to new location (clean URL)
RewriteRule ^inventarizace-drevin/?$ /sluzby/inventarizace-drevin [L,R=301]

# Handle clean URLs - rewrite to .html file for Next.js static export
# This allows Next.js static export to work while serving clean URLs
RewriteCond %{REQUEST_FILENAME} !-f
RewriteCond %{REQUEST_FILENAME} !-d
RewriteCond %{REQUEST_URI} !\.html$
RewriteCond %{REQUEST_URI} !^/$
RewriteCond %{DOCUMENT_ROOT}%{REQUEST_URI}.html -f
RewriteRule ^(.*)$ $1.html [L]

# cele domeny (aliasy)
RewriteCond %{REQUEST_URI} !^domains/
RewriteCond %{REQUEST_URI} !^/domains/
RewriteCond %{HTTP_HOST} ^(www\.)?(.*)$
RewriteCond %{DOCUMENT_ROOT}/domains/%2 -d
RewriteRule (.*) domains/%2/$1 [DPI]

# subdomeny (s nebo bez www na zacatku)
RewriteCond %{REQUEST_URI} !^subdom/
RewriteCond %{REQUEST_URI} !^/subdom/
RewriteCond %{HTTP_HOST} ^(www\.)?(.*)\.([^\.]*)\.([^\.]*)$
RewriteCond %{DOCUMENT_ROOT}/subdom/%2 -d
RewriteRule (.*) subdom/%2/$1 [DPI]

# aliasy - spravne presmerovani pri chybejicim /
RewriteCond %{REQUEST_FILENAME} -d
RewriteRule ^domains/[^/]+/(.+[^/])$ /$1/ [R]

# subdomeny - spravne presmerovani pri chybejicim /
RewriteCond %{REQUEST_FILENAME} -d
RewriteRule ^subdom/[^/]+/(.+[^/])$ /$1/ [R]
